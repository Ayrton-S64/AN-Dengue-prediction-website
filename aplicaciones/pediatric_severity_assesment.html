<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSR - pediatric DSA</title>

    <link rel="stylesheet" href="../style.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/index.css">        
    <script src="../js/index.js"></script>
    <link rel="stylesheet" href="../assets/css/fontawesome-all.min.css">
    <script src="https://kit.fontawesome.com/f2d5daf803.js" crossorigin="anonymous"></script>


</head>

<body>
    <!-- <nav>
        <div class="brand">
            <h1>Hospital santa rosa</h1>
        </div>
        <div class="info">
            <h3>Dengue prediction and prevention program</h3>
        </div>
    </nav> -->


    <div class="header">

        <!--Content before waves-->
        <div class="inner-header flex">
        <!--Just the logo.. Don't mind this-->
       <img style="width: 50px; height: 80px;"  src="../recursos/1x/Recurso 1.png" alt="">
        <h1 style="text-align: center;">HOSPITAL SANTA ROSA</h1>
        </div>
        
        <!--Waves Container-->
        <div>
        <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
        viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7" />
        <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
        <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
        <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
        </g>
        </svg>
        </div>
        <!--Waves end-->
        
    </div>
    <div class="row justify-content-center align-items-center my-5">
        <div class="col-10 text-center">
            <h1 >Severidad de pacientes pediatricos</h1>
        </div>

    </div>
    <div class="content">
        <section>
            <form id="severity_assessment" action="">
                <div>
                    <h3>Rellene el siguiente formulario</h3>
                </div>
                <!-- Edad -->
                <div class="row justify-content-center align-items-center my-5">
                    <div class="col-10">
                        <div class="row justify-content-center align-items-center my-5">
                            <div class="col-3">
                                <div class="">
                                    <label for="">Edad</label>
                                    <div>
                                        <input data-info="clasificacion" required name="edad" class="form-control" type="number">
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="">
                                    <label for="">Genero</label>
                                    <div>
                                        <select class="form-control"  data-info="clasificacion" name="genero">
                                            <option value="1">Masculino</option>
                                            <option value="0">Femenino</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                        <!-- Duración de la fiebre? -->
                                        <div class="">
                                            <label for="">Duración de la fiebre(Días)</label>
                                            <div>
                                                <input required class="form-control" name="duracion_fiebre" type="number">
                                            </div>
                                        </div>
                            </div>
                            <div class="col-3">
                                     <!-- Hemoglobina -->
                                <div class="">
                                    <label for="">Hemoglobina(13-17)</label>
                                    <div>
                                        <input required class="form-control" name="hemoglobina" type="number">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row justify-content-center align-items-center my-5">
                            <div class="col-3">
                                 <!-- Hematocritos -->
                                <div class="">
                                    <label for="">Hematocrito </label>
                                    <div>
                                        <input required class="form-control" name="hematocritos" type="number">
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <!-- Globulos blancos -->
                                <div class="">
                                    <label for="">Globulos blancos</label>
                                    <div>
                                        <input required class="form-control" name="globulos_blancos" type="number">
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <!-- Plaquetas -->
                                <div class="">
                                    <label for="">Plaquetas</label>
                                    <div>
                                        <input required class="form-control" name="plaquetas" type="number">
                                    </div>
                                </div>
                            </div>
                            <div class="col-3">
                                <!-- ALT -->
                                <div class="">
                                    <label for="">ALT</label>
                                    <div>
                                        <input required class="form-control" name="alt" type="number">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row justify-content-center align-items-center my-5">
                            <div class="col-3">
                                    <!-- Creatinina -->
                                    <div class="">
                                        <label for="">Creatinina</label>
                                        <div>
                                            <input required class="form-control" name="creatinina" type="number">
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
               
                <!-- Genero -->
            
                <div>
                    <div>
                        <h1>Sintomatologia</h1>
                    </div>
                    <!-- Creatinina -->

                    <div class="row justify-content-center align-items-center">
                        <div class="col-10">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Sintoma</th>
                                        <th style="text-align: center;">SI</th>
                                        <th style="text-align: center;">NO</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <p>Dolores de cabeza</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="cefalea" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="cefalea" value="0">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Mialgia</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="mialgia" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="mialgia" value="0">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Dolor abdominal</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="dolor_abdominal" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="dolor_abdominal" value="0">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Erupciones</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="erupciones" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="erupciones" value="0">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Vomitos</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="vomitos" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="vomitos" value="0">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Dificultad al respirar</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="dificultad_respirar" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="dificultad_respirar" value="0">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Hemorragia</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="hemorragia" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="hemorragia" value="0">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>Organomegalia</p>
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="organomegalia" value="1">
                                        </td>
                                        <td style="text-align: center;">
                                            <input required data-info="clasificacion" type="radio" name="organomegalia" value="0">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                    </div>
                </div>
                <div class="row justify-content-center align-items-center my-5">
                    <div class="col-10">
                        <div id="formInteractions">
                            <button  type="submit">Enviar</button>
                            <button  onclick="redirectIndex();" type="button">Cancelar</button>
                        </div>
                    </div>
                </div>
                
            </form>
        </section>
    </div>




    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
</body>
<script>
    const form = document.getElementById('severity_assessment')

    function redirectIndex(){
        window.location.href = "index.html";
    }

    function handleFormSubmit(ev){
        ev.preventDefault();
        const formData = new FormData(form);
        let data = {};
        for (const entry of formData) {
            data[entry[0]] = entry[1];
        }
        console.log(data)

        makeApiRequest(data)
            .then(response => {
                // Handle the response data
                console.log('respuesta API: ', response);
                // alert(response.prediction);
                showModal(response.prediction);
                // showResponses(fechas, response.predictions);
            })
            .catch(error => {
                // Handle any errors
                console.error('Error:', error);
            });
    }

    async function makeApiRequest(data){
        try {
            const response = await fetch('http://127.0.0.1:5000/assess-severity', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const result = await response.json();
            return result;
        } catch (error) {
            console.error('Error:', error);
            throw error;
        }
    }

    function showResponses(fechas, respuesta){
        const secPredicciones =  document.querySelector('#secPredicciones')
        const tblBody = document.querySelector('#tbodyPredicciones')

        for(let i = 0; i<fechas.length; i++){
            let fecha = fechas[i];
            let totalCasos = respuesta[i];
            const n_row = document.createElement('tr');
            const fecha_td = document.createElement('td');
            const totalCasos_td = document.createElement('td');

            fecha_td.textContent = fecha;

            totalCasos_td.textContent = Math.round(totalCasos);
            totalCasos_td.align = "center"

            n_row.append(fecha_td,totalCasos_td);
            tblBody.append(n_row);
        }
    }
    function showModal(prediction) {
    // Define el contenido de la ventana modal
    let modalContent;
    $('#myModal').remove();
    if (prediction === "Dengue sin complicaciones") {
        // Contenido de la ventana modal si prediction es "Dengue sin complicaciones"

        modalContent = `
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalTitle">Respuesta</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row justify-content-center align-items-center">
                                <img style="width: 100%; height: 100%;" src="../recursos/img/warning.png" alt="" />
                                <h5>${prediction}</h5>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        `;
    } else {
        // Contenido de la ventana modal para cualquier otro valor de prediction
        modalContent = `
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalTitle">Respuesta</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row justify-content-center align-items-center">
                                <img style="width: 100%; height: 100%;" src="../recursos/img/alert.png"" alt="" />
                                <h5>${prediction}</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // Agrega el contenido a la página
    $('body').append(modalContent);

    // Muestra la ventana modal
    $('#myModal').modal('show');
}

    
    form.onsubmit=handleFormSubmit
</script>
</html>